<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abhishek Kumar - Product Analyst</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- PWA: Link to Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <!-- PWA: Apple Touch Icon for iOS home screen -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <!-- PWA: Theme color for browser UI -->
    <meta name="theme-color" content="#6366f1">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #374151;
            scroll-behavior: smooth; /* Smooth scrolling for anchor links */
            margin: 0; /* Remove default body margin */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        .section-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1.5rem;
            border-bottom: 3px solid #6366f1;
            padding-bottom: 0.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; /* Add transition for hover */
        }
        .card:hover {
            transform: translateY(-5px); /* Lift card slightly on hover */
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.15); /* Enhance shadow on hover */
        }
        .experience-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .experience-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .skill-category {
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.5rem;
            transition: color 0.3s ease-in-out; /* For skill hover effect */
        }
        .skill-category:hover {
            color: #6366f1; /* Change color on hover */
        }
        .project-item {
            margin-bottom: 1rem;
        }
        .award-item {
            margin-bottom: 0.5rem;
        }
        /* Custom Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 80%;
            max-width: 500px;
            text-align: center;
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #6366f1;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Back to Top Button */
        #back-to-top {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed position */
            bottom: 20px; /* 20px from the bottom */
            right: 30px; /* 30px from the right */
            z-index: 99; /* High z-index to be on top */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: #6366f1; /* Background color */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            padding: 15px; /* Some padding */
            border-radius: 50%; /* Rounded corners */
            font-size: 18px; /* Increase font size */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        #back-to-top:hover {
            background-color: #4f46e5; /* Darker background on hover */
            transform: translateY(-3px);
        }

        /* Header specific styles for Three.js canvas */
        .header-content {
            position: relative;
            z-index: 10; /* Ensure content is above canvas */
            padding: 2rem;
        }
        #threejs-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; /* Place canvas behind content */
            border-radius: 0.75rem; /* Match header border-radius */
        }
        header {
            position: relative; /* Needed for absolute positioning of canvas */
            overflow: hidden; /* Hide overflow from canvas */
        }

        /* Chat Modal Specific Styles */
        #chatModal .modal-content {
            max-width: 600px;
            height: 80%;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        #chat-history {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            background-color: #f9fafb;
        }
        .chat-message {
            margin-bottom: 0.75rem;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            max-width: 80%;
        }
        .user-message {
            background-color: #e0e7ff; /* Light indigo */
            align-self: flex-end;
            margin-left: auto;
        }
        .ai-message {
            background-color: #d1fae5; /* Light green */
            align-self: flex-start;
            margin-right: auto;
        }
        #chat-input-container {
            display: flex;
            gap: 0.5rem;
        }
        #chat-input {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            resize: vertical;
            min-height: 40px;
        }
        #send-button {
            padding: 0.75rem 1.25rem;
            background-color: #6366f1;
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #send-button:hover {
            background-color: #4f46e5;
        }
        .chat-loader {
            display: none;
            margin-top: 0.5rem;
            text-align: center;
        }
        .company-logo {
            height: 24px; /* Adjust size as needed */
            width: auto;
            vertical-align: middle;
            margin-right: 8px;
            border-radius: 4px; /* Slightly rounded corners for logos */
        }
    </style>
</head>
<body class="antialiased">
    <!-- Sticky Navigation Bar -->
    <nav class="sticky top-0 z-50 bg-white shadow-md py-4 px-8 rounded-b-xl">
        <ul class="flex justify-center space-x-8 text-lg font-medium">
            <li><a href="#profile" class="text-gray-700 hover:text-indigo-600 transition duration-300">Profile</a></li>
            <li><a href="#experience" class="text-gray-700 hover:text-indigo-600 transition duration-300">Experience</a></li>
            <li><a href="#skills" class="text-gray-700 hover:text-indigo-600 transition duration-300">Skills</a></li>
            <li><a href="#projects" class="text-gray-700 hover:text-indigo-600 transition duration-300">Projects</a></li>
            <li><a href="#education" class="text-gray-700 hover:text-indigo-600 transition duration-300">Education</a></li>
            <li><a href="#awards" class="text-gray-700 hover:text-indigo-600 transition duration-300">Awards</a></li>
        </ul>
    </nav>

    <div class="container">
        <!-- Header Section -->
        <header class="text-center py-8 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl shadow-lg mb-8">
            <canvas id="threejs-canvas"></canvas>
            <div class="header-content">
                <h1 class="text-5xl font-extrabold mb-2">Abhishek Kumar</h1>
                <p class="text-2xl font-light">Product Analyst</p>
                <div class="flex justify-center space-x-6 mt-4">
                    <a href="mailto:skumar.abhishek18014@gmail.com" class="text-white hover:text-indigo-200 transition duration-300">
                        <svg class="w-6 h-6 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path><path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path></svg>
                        skumar.abhishek18014@gmail.com
                    </a>
                    <a href="tel:+919756730523" class="text-white hover:text-indigo-200 transition duration-300">
                        <svg class="w-6 h-6 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.774a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path></svg>
                        +91 9756730523
                    </a>
                    <a href="https://www.linkedin.com/in/abhishek-kumar" target="_blank" class="text-white hover:text-indigo-200 transition duration-300">
                        <svg class="w-6 h-6 inline-block mr-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.3 0H3.7A3.7 3.7 0 000 3.7v12.6A3.7 3.7 0 003.7 20h12.6A3.7 3.7 0 0020 16.3V3.7A3.7 3.7 0 0016.3 0zM7.2 16.5H4.5V7.5h2.7v9zM5.8 6.2a1.7 1.7 0 110-3.4 1.7 1.7 0 010 3.4zm10.7 10.3h-2.7v-4.5c0-1.1-.4-1.8-1.4-1.8-.8 0-1.3.6-1.5 1.2-.1.2-.1.4-.1.7v4.4H9.5V7.5h2.7v1.2c.4-.6 1.1-1.4 2.5-1.4 1.8 0 3.2 1.2 3.2 3.8v5.4z" clip-rule="evenodd"></svg>
                        LinkedIn
                    </a>
                </div>
                <p class="text-lg mt-2">Bangalore, Karnataka</p>
            </div>
        </header>

        <!-- Profile Section -->
        <section id="profile" class="card">
            <h2 class="section-title">Profile</h2>
            <p id="profile-text" class="text-gray-700 leading-relaxed mb-4">
                Results-driven Analytics Professional with 2+ years of experience in product analytics, business intelligence, and data automation
                across e-commerce and fintech. Proficient in SQL, Python, Tableau, and Looker with expertise in building dashboards, funnel
                analysis, root cause analysis (RCA), and user segmentation. Demonstrated success in improving conversion rates, optimizing
                inventory, automating reporting pipelines, and driving metric-driven decision-making. Strong background in stakeholder
                management, metric design, and cross-functional collaboration with product, engineering, and operations teams.
            </p>
            <div class="flex justify-center space-x-4 mt-4">
                <button id="summarize-button" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    Summarize Profile ✨
                </button>
                <button id="chat-button" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out transform hover:scale-105">
                    Chat with AI Assistant 💬
                </button>
            </div>
            <div id="summary-output" class="mt-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200 text-gray-800 hidden">
                <h3 class="font-semibold text-lg mb-2">AI-Generated Summary:</h3>
                <p id="summary-text"></p>
            </div>
        </section>

        <!-- Work Experience Section -->
        <section id="experience" class="card">
            <h2 class="section-title">Work Experience</h2>

            <div class="experience-item">
                <h3 class="text-xl font-semibold text-gray-800">Product Analyst</h3>
                <p class="text-lg text-indigo-600">
                    <b>Myntra</b>
                </p>
                <p class="text-sm text-gray-500 mb-2">11/2024 - Present</p>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li>Reduced stockouts by <b>20%</b> via rule-based inventory model across 20K+ styles, automated weekly performance tracking.</li>
                    <li>Improved PLP CTR by <b>15-20%</b> through data-driven sort logic using product scoring in collaboration with Storefront.</li>
                    <li>Identified <b>3x</b> conversion gap via SPU/session simulations; influenced product roadmap and engagement strategy.</li>
                    <li>Validated <b>2x MoM lift</b> in FWD conversions following Glitchez assortment expansion, strengthening the case for hero-SKU investment.</li>
                    <li>Reduced bounce-offs in FWD Context by identifying key funnel breaks, enabling targeted fixes in high-traffic apparel subcategories.</li>
                    <li>Projected <b>3x</b> conversion uplift for FWD Context by realigning SPU distribution and normalizing session mix with platform benchmarks.</li>
                    <li>Built category-specific funnel diagnostics to identify top-leaking styles (e.g., T-shirts, Jeans), enabling data-driven prioritization for assortment and UX improvements.</li>
                </ul>
            </div>

            <div class="experience-item">
                <h3 class="text-xl font-semibold text-gray-800">Data Analyst</h3>
                <p class="text-lg text-indigo-600">
                    <b>Razorpay Software Private Limited</b>
                </p>
                <p class="text-sm text-gray-500 mb-2">07/2023 - 11/2024</p>
                <ul class="list-disc list-inside text-gray-700 space-y-1">
                    <li>Process Automation: Designed Python-based automation tools to generate banking reports, reducing processing time from 3+ hours to 20 minutes (<b>90% efficiency gain</b>).</li>
                    <li>Dashboard Migration & Visualization: Led migration of 15+ dashboards from Looker to Tableau, creating self-serve tools that reduced ad-hoc requests by <b>30%</b>.</li>
                    <li>Metrics Optimization: Redefined KPIs for the Card/UPI Optimization Framework, improving workflow efficiency by <b>70%</b> and saving <b>25 lakhs annually</b>.</li>
                    <li>Compliance Automation: Built a fuzzy logic solution in Python for CIN/PAN verification, boosting accuracy by <b>30%</b> and minimizing regulatory errors.</li>
                </ul>
            </div>
        </section>

        <!-- Skills Section -->
        <section id="skills" class="card">
            <h2 class="section-title">Skills</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-gray-700">
                <div>
                    <p class="skill-category"><b>Tools:</b></p>
                    <p>Airflow, Databricks, Jupyter Notebook, Google sheets, Tableau, Looker</p>
                </div>
                <div>
                    <p class="skill-category"><b>Languages:</b></p>
                    <p>SQL, PostgreSQL, MySQL, Python, SparkSQL</p>
                </div>
                <div>
                    <p class="skill-category"><b>Other:</b></p>
                    <p>Stakeholder management, Statistics, Exploratory Data analysis, RCA</p>
                </div>
            </div>
        </section>

        <!-- Projects Section -->
        <section id="projects" class="card">
            <h2 class="section-title">Projects</h2>
            <div class="project-item">
                <h3 class="text-xl font-semibold text-gray-800"><b>Rule based Model to identify Top selling style</b></h3>
                <p class="text-gray-700">Developed rules based model which assigning a normalize score and rank styles according with certain threshold.</p>
            </div>
            <div class="project-item">
                <h3 class="text-xl font-semibold text-gray-800"><b>Card and UPI optimization framework</b></h3>
                <p class="text-gray-700">Revamped metrics and workflows, achieving 70% operational efficiency.</p>
            </div>
            <div class="project-item">
                <h3 class="text-xl font-semibold text-gray-800"><b>Robotic Process Automation for Bank Reports</b></h3>
                <p class="text-gray-700">Saved 50+ hours monthly by automating report generation.</p>
            </div>
        </section>

        <!-- Education Section -->
        <section id="education" class="card">
            <h2 class="section-title">Education</h2>
            <h3 class="text-xl font-semibold text-gray-800"><b>Bachelor of Engineering (Electronics and Communication)</b></h3>
            <p class="text-lg text-indigo-600">Dayananda Sagar College of Engineering, Bangalore</p>
            <p class="text-sm text-gray-500">2019-2023</p>
        </section>

        <!-- Awards Section -->
        <section id="awards" class="card">
            <h2 class="section-title">Awards</h2>
            <div class="award-item">
                <h3 class="text-xl font-semibold text-gray-800"><b>Most Valuable Player at Razorpay</b></h3>
                <p class="text-gray-700">Recognized for exceptional performance and ownership.</p>
            </div>
        </section>

        <!-- Footer Section -->
        <footer class="text-center py-6 text-gray-600">
            <p>&copy; 2025 Abhishek Kumar. All rights reserved.</p>
        </footer>
    </div>

    <!-- Back to Top Button -->
    <button onclick="topFunction()" id="back-to-top" title="Go to top">↑</button>

    <!-- Custom Modal for Loading and Summaries -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('myModal').style.display='none'">&times;</span>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('chatModal').style.display='none'">&times;</span>
            <h3 class="text-2xl font-semibold mb-4 text-gray-800">AI Assistant Chat</h3>
            <div id="chat-history" class="flex flex-col mb-4">
                <!-- Chat messages will appear here -->
            </div>
            <div id="chat-input-container">
                <textarea id="chat-input" class="flex-grow p-2 border rounded-lg resize-none" placeholder="Ask a question about Abhishek's portfolio..."></textarea>
                <button id="send-button" class="bg-indigo-500 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg">Send</button>
            </div>
            <div id="chat-loader" class="chat-loader">
                <div class="loader"></div>
                <p class="mt-2">AI is typing...</p>
            </div>
        </div>
    </div>

    <script>
        // PWA: Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const serviceWorkerUrl = '/service-worker.js';
                // Added console.log to confirm the URL being registered
                console.log('Attempting to register Service Worker from:', serviceWorkerUrl);
                navigator.serviceWorker.register(serviceWorkerUrl)
                    .then(registration => {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // Smooth scroll for navigation links
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Get the back-to-top button
        let mybutton = document.getElementById("back-to-top");

        // When the user scrolls down 20px from the top of the document, show the button
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                mybutton.style.display = "block";
            } else {
                mybutton.style.display = "none";
            }
        }

        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
            document.body.scrollTop = 0; // For Safari
            document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
        }

        // Gemini API integration for summarizing profile
        document.getElementById('summarize-button').addEventListener('click', async () => {
            const profileTextElement = document.getElementById('profile-text');
            const summaryOutputElement = document.getElementById('summary-output');
            const summaryTextElement = document.getElementById('summary-text');
            const modal = document.getElementById('myModal');
            const modalBody = document.getElementById('modal-body');

            // Show loading indicator
            summaryOutputElement.classList.add('hidden');
            modal.style.display = 'flex';
            modalBody.innerHTML = '<div class="loader"></div><p class="mt-4">Generating summary...</p>';

            const profileContent = profileTextElement.textContent.trim();
            const prompt = `Please summarize the following professional profile in a concise manner, highlighting key skills and achievements:\n\n${profileContent}`;

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    summaryTextElement.textContent = text;
                    summaryOutputElement.classList.remove('hidden');
                    modal.style.display = 'none'; // Hide modal on success
                } else {
                    console.error('Gemini API response structure unexpected:', result);
                    modalBody.innerHTML = '<p class="text-red-500">Error: Could not generate summary. Please try again.</p>';
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                modalBody.innerHTML = '<p class="text-red-500">Network error or API call failed. Please check your connection and try again.</p>';
            }
        });

        // Three.js Animation Setup
        let scene, camera, renderer, sphere;
        let mouseX = 0, mouseY = 0;
        let windowHalfX = window.innerWidth / 2;
        let windowHalfY = window.innerHeight / 2;
        let headerElement;

        function initThreeJS() {
            headerElement = document.querySelector('header');
            const canvas = document.getElementById('threejs-canvas');

            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(75, headerElement.clientWidth / headerElement.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true }); // Alpha true for transparent background
            renderer.setSize(headerElement.clientWidth, headerElement.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5); // Soft white light
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(0, 1, 1);
            scene.add(directionalLight);

            // Geometry (Sphere)
            const geometry = new THREE.SphereGeometry(1, 32, 32);
            const material = new THREE.MeshPhongMaterial({ color: 0x8A2BE2, shininess: 100 }); // Purple color, shiny
            sphere = new THREE.Mesh(geometry, material);
            scene.add(sphere);

            // Event Listeners for mouse interaction
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);

            animateThreeJS();
        }

        function onDocumentMouseMove(event) {
            mouseX = (event.clientX - windowHalfX) / 100;
            mouseY = (event.clientY - windowHalfY) / 100;
        }

        function onWindowResize() {
            if (headerElement) {
                camera.aspect = headerElement.clientWidth / headerElement.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(headerElement.clientWidth, headerElement.clientHeight);
            }
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
        }

        function animateThreeJS() {
            requestAnimationFrame(animateThreeJS);

            // Rotate the sphere
            sphere.rotation.x += 0.005;
            sphere.rotation.y += 0.005;

            // Move camera based on mouse position
            camera.position.x += (mouseX - camera.position.x) * .05;
            camera.position.y += (-mouseY - camera.position.y) * .05;
            camera.lookAt(scene.position);

            renderer.render(scene, camera);
        }

        // Initialize Three.js when the window loads
        window.onload = function() {
            initThreeJS();
        };

        // AI Assistant Chat Logic
        const chatButton = document.getElementById('chat-button');
        const chatModal = document.getElementById('chatModal');
        const chatHistory = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatLoader = document.getElementById('chat-loader');

        // Function to collect all portfolio text for context
        function getPortfolioContext() {
            const sections = document.querySelectorAll('section[id]');
            let context = "Here is the portfolio information about Abhishek Kumar:\n\n";
            sections.forEach(section => {
                context += `--- ${section.id.toUpperCase()} ---\n`;
                context += section.textContent.trim() + "\n\n";
            });
            return context;
        }

        chatButton.addEventListener('click', () => {
            chatModal.style.display = 'flex';
            chatHistory.innerHTML = ''; // Clear previous chat history
            chatInput.value = ''; // Clear input field
            // Add initial greeting message from AI
            addMessageToChat('Hello! I am an AI assistant. Ask me anything about Abhishek Kumar\'s portfolio.', 'ai');
        });

        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // Prevent new line in textarea
                sendMessage();
            }
        });

        async function sendMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            addMessageToChat(userMessage, 'user');
            chatInput.value = '';
            chatLoader.style.display = 'block';
            chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to bottom

            const portfolioContext = getPortfolioContext();
            const prompt = `Based on the following portfolio information, answer the user's question. If the information is not directly available in the portfolio, state that you cannot answer based on the provided data.
            \n\nPortfolio Information:\n${portfolioContext}\n\nUser Question: ${userMessage}`;

            try {
                let chatHistoryArr = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistoryArr };
                const apiKey = ""; // Canvas will automatically provide this at runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const aiResponseText = result.candidates[0].content.parts[0].text;
                    addMessageToChat(aiResponseText, 'ai');
                } else {
                    console.error('Gemini API response structure unexpected:', result);
                    addMessageToChat('I apologize, but I could not generate a response. Please try again.', 'ai');
                }
            } catch (error) {
                console.error('Error calling Gemini API for chat:', error);
                modalBody.innerHTML = '<p class="text-red-500">Network error or API call failed. Please check your connection and try again.</p>'; // Use modalBody for general errors
                addMessageToChat('I am having trouble connecting to the AI. Please check your internet connection or try again later.', 'ai'); // Also add to chat history
            } finally {
                chatLoader.style.display = 'none';
                chatHistory.scrollTop = chatHistory.scrollHeight; // Scroll to bottom after AI response
            }
        }

        function addMessageToChat(message, sender) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', `${sender}-message`);
            messageElement.textContent = message;
            chatHistory.appendChild(messageElement);
        }
    </script>
</body>
</html>
